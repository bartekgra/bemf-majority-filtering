# Back EMF Majority Function Filtering for BLDC

## About The Project
Project is create to simulate real waveform of signals from BLDC motor called Back Electromotive Force (BEMF) containing interferences. Main aim of this project is to show how detect when zero crossing occure using Majority Filter and conseqeunty of that when commutator phase switch function should execute. Simulation assumes a constant engine rotation.


Project relates to an article Digi-Key: https://www.digikey.pl/pl/articles/sensorless-bldc-motor-control-with-back-emf-filtering-using-a-majority-function


## Run Simulate

Create object ```c_cpp bldc ``` with all number of samples and number of samples per phase (assuming a constant engine rotation):
```c_cpp
EmulatorBLDC bldc = EmulatorBLDC(numberOfSamples, numberOfSamplesInPhase);
```

Set phase states with start phase commutator position and probability of occuring noise:
```c_cpp
bldc.setPhaseStates(startPhase, noiseProbabilityInPercent);
```

Run filter including zero crossing and switch phase event:
```c_cpp
bldc.BEMFFilter();
```

Print in terminal all simulation states in next samples:
```c_cpp
bldc.printAll();
```

## Example
For initial parameters:
```c_cpp
    int numberOfSamples = 280;
    int numberOfSamplesInPhase = 20;
    int noiseProbabilityInPercent = 50;
    int startPhase = 4;
```

We get:
<details><summary>show example</summary>
<p>
```c_cpp
No. | Sig. ABC|Log|Com|Filter
0   |  0 1 1  | 1 | 0 | 2
1   |  1 1 0  | 1 | 0 | 6
2   |  1 1 0  | 1 | 0 | 14
3   |  1 0 1  | 0 | 0 | 28
4   |  1 1 0  | 1 | 0 | 58
5   |  1 1 0  | 1 | 0 | 54
6   |  0 0 0  | 0 | 0 | 44
7   |  1 1 0  | 1 | 0 | 26
8   |  1 1 1  | 1 | 0 | 54
9   |  0 0 0  | 0 | 0 | 44
10  |  1 1 0  | 1 | 0 | 26
11  |  1 1 1  | 1 | 0 | 54
12  |  1 1 0  | 1 | 0 | 46
13  |  1 0 0  | 0 | 0 | 28
14  |  0 1 0  | 1 | 0 | 58
15  |  1 1 1  | 1 | 0 | 54
16  |  1 1 0  | 1 | 0 | 46
17  |  0 1 0  | 1 | 0 | 30
18  |  1 1 1  | 1 | 0 | 62
19  |  1 0 0  | 0 | 0 | 60
20  |  0 0 0  | 0 | 1 | 1  <- zero crossing event
21  |  1 0 1  | 0 | 1 | 2
22  |  1 1 0  | 1 | 1 | 6
23  |  0 0 0  | 1 | 1 | 14  <- switch phase event
24  |  1 0 0  | 1 | 1 | 30
25  |  1 1 1  | 0 | 1 | 60
26  |  1 0 0  | 1 | 1 | 58
27  |  0 0 0  | 1 | 1 | 54
28  |  1 1 0  | 1 | 1 | 46
29  |  1 0 1  | 0 | 1 | 28
30  |  0 0 0  | 1 | 1 | 58
31  |  1 1 0  | 1 | 1 | 54
32  |  1 0 1  | 0 | 1 | 44
33  |  0 0 0  | 1 | 1 | 26
34  |  1 0 0  | 1 | 1 | 54
35  |  1 0 1  | 0 | 1 | 44
36  |  1 0 0  | 1 | 1 | 26
37  |  0 1 0  | 1 | 1 | 54
38  |  1 0 0  | 1 | 1 | 46
39  |  1 0 1  | 0 | 1 | 28
40  |  1 0 1  | 0 | 2 | 1  <- zero crossing event
41  |  0 0 1  | 0 | 2 | 2
42  |  1 0 0  | 1 | 2 | 6
43  |  1 0 1  | 1 | 2 | 14
44  |  0 1 1  | 0 | 2 | 28
45  |  1 0 1  | 1 | 2 | 58
46  |  1 0 1  | 1 | 2 | 54  <- switch phase event
47  |  1 0 1  | 1 | 2 | 46
48  |  0 1 0  | 0 | 2 | 28
49  |  1 0 1  | 1 | 2 | 58
50  |  1 0 1  | 1 | 2 | 54
51  |  0 1 1  | 0 | 2 | 44
52  |  1 0 1  | 1 | 2 | 26
53  |  1 0 1  | 1 | 2 | 54
54  |  0 1 0  | 0 | 2 | 44
55  |  1 0 1  | 1 | 2 | 26
56  |  1 0 1  | 1 | 2 | 54
57  |  0 0 0  | 0 | 2 | 44
58  |  1 1 1  | 1 | 2 | 26
59  |  1 0 1  | 1 | 2 | 54
60  |  0 0 1  | 0 | 2 | 44
61  |  0 1 0  | 0 | 3 | 1  <- zero crossing event
62  |  1 0 1  | 1 | 3 | 2
63  |  0 0 1  | 1 | 3 | 6
64  |  0 0 0  | 1 | 3 | 14
65  |  1 1 1  | 0 | 3 | 28
66  |  0 0 1  | 1 | 3 | 58
67  |  0 0 1  | 1 | 3 | 54
68  |  1 1 0  | 0 | 3 | 44
69  |  0 0 1  | 1 | 3 | 26
70  |  0 0 1  | 1 | 3 | 54
71  |  1 0 0  | 1 | 3 | 46  <- switch phase event
72  |  0 0 1  | 1 | 3 | 30
73  |  0 1 1  | 0 | 3 | 60
74  |  1 0 0  | 1 | 3 | 58
75  |  0 0 1  | 1 | 3 | 54
76  |  0 0 1  | 1 | 3 | 46
77  |  0 0 1  | 1 | 3 | 30
78  |  1 0 1  | 1 | 3 | 62
79  |  0 1 1  | 0 | 3 | 60
80  |  0 1 1  | 0 | 4 | 1  <- zero crossing event
81  |  0 1 1  | 1 | 4 | 2
82  |  1 1 1  | 1 | 4 | 6
83  |  0 0 0  | 0 | 4 | 12
84  |  0 1 1  | 1 | 4 | 26
85  |  1 1 1  | 1 | 4 | 54
86  |  0 0 1  | 1 | 4 | 46
87  |  0 1 0  | 0 | 4 | 28
88  |  0 1 1  | 1 | 4 | 58
89  |  0 0 1  | 1 | 4 | 54
90  |  0 1 1  | 1 | 4 | 46  <- switch phase event
91  |  0 1 0  | 0 | 4 | 28
92  |  1 0 1  | 1 | 4 | 58
93  |  0 1 1  | 1 | 4 | 54
94  |  0 1 1  | 1 | 4 | 46
95  |  1 0 1  | 1 | 4 | 30
96  |  0 1 1  | 1 | 4 | 62
97  |  0 1 1  | 1 | 4 | 62
98  |  1 0 1  | 1 | 4 | 62
99  |  0 1 1  | 1 | 4 | 62
100 |  0 1 0  | 0 | 4 | 60
101 |  0 0 0  | 0 | 5 | 1  <- zero crossing event
102 |  1 1 1  | 0 | 5 | 2
103 |  0 1 0  | 1 | 5 | 6
104 |  0 1 0  | 1 | 5 | 14
105 |  1 1 0  | 0 | 5 | 28
106 |  0 0 1  | 1 | 5 | 58
107 |  0 1 0  | 1 | 5 | 54
108 |  0 1 0  | 1 | 5 | 46
109 |  1 1 1  | 0 | 5 | 28
110 |  0 1 0  | 1 | 5 | 58
111 |  0 0 0  | 1 | 5 | 54  <- switch phase event
112 |  1 1 0  | 0 | 5 | 44
113 |  0 1 0  | 1 | 5 | 26
114 |  0 1 1  | 1 | 5 | 54
115 |  1 0 0  | 0 | 5 | 44
116 |  0 1 0  | 1 | 5 | 26
117 |  0 1 0  | 1 | 5 | 54
118 |  0 0 0  | 1 | 5 | 46
119 |  1 1 0  | 0 | 5 | 28
120 |  1 1 0  | 0 | 0 | 1  <- zero crossing event
121 |  1 0 0  | 0 | 0 | 2
122 |  1 1 0  | 1 | 0 | 6
123 |  0 1 1  | 1 | 0 | 14
124 |  1 0 0  | 0 | 0 | 28
125 |  1 1 0  | 1 | 0 | 58
126 |  1 1 0  | 1 | 0 | 54
127 |  0 1 0  | 1 | 0 | 46
128 |  1 0 0  | 0 | 0 | 28
129 |  1 1 1  | 1 | 0 | 58  <- switch phase event
130 |  0 1 0  | 1 | 0 | 54
131 |  1 0 0  | 0 | 0 | 44
132 |  1 1 1  | 1 | 0 | 26
133 |  1 1 0  | 1 | 0 | 54
134 |  1 1 0  | 1 | 0 | 46
135 |  1 0 0  | 0 | 0 | 28
136 |  0 1 1  | 1 | 0 | 58
137 |  1 1 0  | 1 | 0 | 54
138 |  1 0 0  | 0 | 0 | 44
139 |  1 1 0  | 1 | 0 | 26
140 |  0 0 1  | 0 | 1 | 1  <- zero crossing event
141 |  1 1 0  | 1 | 1 | 2
142 |  1 0 0  | 1 | 1 | 6
143 |  1 0 1  | 0 | 1 | 12
144 |  1 0 0  | 1 | 1 | 26
145 |  1 0 0  | 1 | 1 | 54
146 |  0 1 1  | 0 | 1 | 44
147 |  1 0 0  | 1 | 1 | 26
148 |  1 0 0  | 1 | 1 | 54
149 |  1 0 1  | 0 | 1 | 44
150 |  0 1 0  | 1 | 1 | 26  <- switch phase event
151 |  1 0 0  | 1 | 1 | 54
152 |  1 0 0  | 1 | 1 | 46
153 |  1 0 0  | 1 | 1 | 30
154 |  0 0 1  | 0 | 1 | 60
155 |  1 1 0  | 1 | 1 | 58
156 |  1 0 0  | 1 | 1 | 54
157 |  1 0 1  | 0 | 1 | 44
158 |  1 1 0  | 1 | 1 | 26
159 |  1 0 0  | 1 | 1 | 54
160 |  1 0 1  | 0 | 1 | 44
161 |  1 0 1  | 0 | 2 | 1  <- zero crossing event
162 |  0 1 0  | 0 | 2 | 2
163 |  1 0 1  | 1 | 2 | 6
164 |  1 0 1  | 1 | 2 | 14
165 |  1 1 1  | 1 | 2 | 30
166 |  1 0 1  | 1 | 2 | 62
167 |  1 0 0  | 1 | 2 | 62
168 |  0 1 1  | 0 | 2 | 60
169 |  1 0 1  | 1 | 2 | 58
170 |  1 0 1  | 1 | 2 | 54
171 |  0 0 1  | 0 | 2 | 44  <- switch phase event
172 |  1 0 1  | 1 | 2 | 26
173 |  1 1 0  | 1 | 2 | 54
174 |  1 0 1  | 1 | 2 | 46
175 |  0 0 1  | 0 | 2 | 28
176 |  1 1 0  | 1 | 2 | 58
177 |  1 0 1  | 1 | 2 | 54
178 |  1 0 1  | 1 | 2 | 46
179 |  1 1 1  | 1 | 2 | 30
180 |  0 0 1  | 0 | 2 | 60
181 |  0 0 0  | 0 | 3 | 1  <- zero crossing event
182 |  1 1 1  | 0 | 3 | 2
183 |  0 0 1  | 1 | 3 | 6
184 |  0 0 1  | 1 | 3 | 14
185 |  1 1 1  | 0 | 3 | 28
186 |  0 0 0  | 1 | 3 | 58
187 |  0 0 1  | 1 | 3 | 54
188 |  0 1 1  | 0 | 3 | 44
189 |  1 0 1  | 1 | 3 | 26
190 |  0 0 0  | 1 | 3 | 54
191 |  0 1 1  | 0 | 3 | 44  <- switch phase event
192 |  0 0 1  | 1 | 3 | 26
193 |  0 0 1  | 1 | 3 | 54
194 |  0 1 1  | 0 | 3 | 44
195 |  0 0 1  | 1 | 3 | 26
196 |  1 0 0  | 1 | 3 | 54
197 |  0 1 1  | 0 | 3 | 44
198 |  0 0 1  | 1 | 3 | 26
199 |  1 0 0  | 1 | 3 | 54
200 |  0 0 1  | 1 | 3 | 46
201 |  0 1 1  | 0 | 3 | 28
202 |  1 1 0  | 0 | 4 | 1  <- zero crossing event
203 |  0 0 1  | 1 | 4 | 2
204 |  0 1 1  | 1 | 4 | 6
205 |  1 1 0  | 0 | 4 | 12
206 |  0 0 1  | 1 | 4 | 26
207 |  0 1 1  | 1 | 4 | 54
208 |  0 1 1  | 1 | 4 | 46
209 |  1 0 0  | 0 | 4 | 28
210 |  0 1 1  | 1 | 4 | 58
211 |  0 1 1  | 1 | 4 | 54
212 |  1 1 1  | 1 | 4 | 46  <- switch phase event
213 |  0 1 1  | 1 | 4 | 30
214 |  0 0 1  | 1 | 4 | 62
215 |  0 1 0  | 0 | 4 | 60
216 |  1 1 1  | 1 | 4 | 58
217 |  0 1 1  | 1 | 4 | 54
218 |  0 1 1  | 1 | 4 | 46
219 |  0 1 1  | 1 | 4 | 30
220 |  0 0 0  | 0 | 4 | 60
221 |  1 1 1  | 1 | 4 | 58
222 |  0 1 0  | 0 | 5 | 1  <- zero crossing event
223 |  0 1 0  | 1 | 5 | 2
224 |  0 1 1  | 1 | 5 | 6
225 |  1 1 0  | 0 | 5 | 12
226 |  0 1 0  | 1 | 5 | 26
227 |  0 1 1  | 1 | 5 | 54
228 |  0 0 0  | 1 | 5 | 46
229 |  1 1 0  | 0 | 5 | 28
230 |  0 1 1  | 1 | 5 | 58
231 |  0 0 0  | 1 | 5 | 54
232 |  1 1 0  | 0 | 5 | 44  <- switch phase event
233 |  0 1 1  | 1 | 5 | 26
234 |  0 1 0  | 1 | 5 | 54
235 |  0 1 0  | 1 | 5 | 46
236 |  0 0 1  | 1 | 5 | 30
237 |  1 1 0  | 0 | 5 | 60
238 |  0 1 0  | 1 | 5 | 58
239 |  0 1 1  | 1 | 5 | 54
240 |  1 0 0  | 0 | 5 | 44
241 |  0 1 0  | 1 | 5 | 26
242 |  1 1 0  | 0 | 0 | 1  <- zero crossing event
243 |  1 1 1  | 1 | 0 | 2
244 |  0 0 0  | 0 | 0 | 4
245 |  1 1 0  | 1 | 0 | 10
246 |  1 1 1  | 1 | 0 | 22
247 |  1 0 0  | 0 | 0 | 44
248 |  0 1 0  | 1 | 0 | 26
249 |  1 1 0  | 1 | 0 | 54
250 |  1 0 0  | 0 | 0 | 44
251 |  0 1 1  | 1 | 0 | 26
252 |  1 1 0  | 1 | 0 | 54  <- switch phase event
253 |  1 0 0  | 0 | 0 | 44
254 |  1 1 0  | 1 | 0 | 26
255 |  1 1 1  | 1 | 0 | 54
256 |  0 0 0  | 0 | 0 | 44
257 |  1 1 0  | 1 | 0 | 26
258 |  1 1 1  | 1 | 0 | 54
259 |  1 0 0  | 0 | 0 | 44
260 |  0 0 0  | 0 | 1 | 1  <- zero crossing event
261 |  1 0 1  | 0 | 1 | 2
262 |  1 0 0  | 1 | 1 | 6
263 |  1 0 0  | 1 | 1 | 14
264 |  0 0 1  | 0 | 1 | 28
265 |  1 1 0  | 1 | 1 | 58
266 |  1 0 0  | 1 | 1 | 54
267 |  1 0 1  | 0 | 1 | 44
268 |  1 1 0  | 1 | 1 | 26
269 |  0 0 0  | 1 | 1 | 54  <- switch phase event
270 |  1 0 0  | 1 | 1 | 46
271 |  1 1 0  | 1 | 1 | 30
272 |  0 0 1  | 0 | 1 | 60
273 |  1 0 0  | 1 | 1 | 58
274 |  1 0 0  | 1 | 1 | 54
275 |  0 0 1  | 0 | 1 | 44
276 |  1 1 0  | 1 | 1 | 26
277 |  1 0 0  | 1 | 1 | 54
278 |  0 0 0  | 1 | 1 | 46
279 |  1 1 1  | 0 | 1 | 28
```
</p>
</details>